{"version":3,"sources":["../src/index.ts","../src/array-cleaning.ts","../src/cast-to-number.ts","../src/merge-classes.ts","../src/request/index.ts","../src/request/get.ts","../src/request/post.ts","../src/strip-html.ts","../src/type-check/is-undefined.ts"],"sourcesContent":["export type { RemovableValues } from \"./array-cleaning\";\nexport { arrayCleaning } from \"./array-cleaning\";\nexport { castToNumber } from \"./cast-to-number\";\nexport type { ClassNameCandidate } from \"./merge-classes\";\nexport { mergeClasses } from \"./merge-classes\";\nexport type {\n  ErrorResult,\n  Fetcher,\n  RequestFailure,\n  RequestParser,\n  RequestResult,\n  RequestSuccess,\n} from \"./request\";\nexport { RESPONSE_STATUS } from \"./request\";\nexport type { GetRequestOptions } from \"./request/get\";\nexport { getRequest } from \"./request/get\";\nexport type { PostRequestOptions } from \"./request/post\";\nexport { postRequest } from \"./request/post\";\nexport { stripHtml } from \"./strip-html\";\nexport { isUndefined } from \"./type-check/is-undefined\";\n","export type RemovableValues = false | null | undefined;\n\n/**\n * 配列から `undefined`・`null`・`false` を取り除き、残りの要素を返す。\n *\n * @param items - フィルタリング対象の配列\n * @returns falsy 値（`false`・`null`・`undefined`）を取り除いた新しい配列\n */\nexport function arrayCleaning<T>(\n  items: readonly T[],\n): Exclude<T, RemovableValues>[] {\n  return items.filter((item): item is Exclude<T, RemovableValues> => {\n    return item !== undefined && item !== null && item !== false;\n  });\n}\n","/**\n * 与えられた値を整数に変換する。変換できない場合はフォールバック値、もしくは `undefined` を返す。\n *\n * @param data - 数値化を試みる値\n * @param fallbackData - 変換に失敗した際に返すフォールバック値\n * @returns 変換後の数値、またはフォールバック値／`undefined`\n */\nexport function castToNumber(data: unknown): number | undefined;\nexport function castToNumber(data: unknown, fallbackData: number): number;\nexport function castToNumber(\n  data: unknown,\n  fallbackData?: number,\n): number | undefined {\n  if (typeof data === \"number\") {\n    return data;\n  }\n\n  if (typeof data === \"string\") {\n    const parsedData = Number.parseInt(data, 10);\n    if (!Number.isNaN(parsedData)) {\n      return parsedData;\n    }\n  }\n\n  return fallbackData;\n}\n","import { arrayCleaning } from \"./array-cleaning\";\n\nexport type ClassNameCandidate = string | false | null | undefined;\n\n/**\n * クラス候補のリストをまとめて結合し、 falsy な要素を除去した文字列を返す。\n *\n * @param classes - クラス名または falsy を含む可変長引数\n * @returns スペース区切りで結合されたクラス名\n */\nexport function mergeClasses(...classes: ClassNameCandidate[]): string {\n  return arrayCleaning<ClassNameCandidate>(classes).join(\" \");\n}\n","export type Fetcher = typeof fetch;\nexport type ErrorResult = {\n  code: string;\n  message: string;\n};\n\nexport type RequestSuccess<T = unknown> = {\n  ok: typeof RESPONSE_STATUS.success;\n  data: T;\n};\nexport type RequestFailure = {\n  ok: typeof RESPONSE_STATUS.failure;\n  data?: never;\n  error: ErrorResult;\n};\nexport type RequestResult<T = unknown> = RequestSuccess<T> | RequestFailure;\nexport type RequestParser<T = unknown> = (response: Response) => Promise<T>;\n\nexport const RESPONSE_STATUS = {\n  success: true,\n  failure: false,\n} as const;\n\nexport const defaultParser = async <T = unknown>(\n  response: Response,\n): Promise<T> => {\n  return (await response.json()) as T;\n};\nexport const generateRequestFailure = (\n  code: string,\n  message: string,\n): RequestFailure => {\n  return {\n    error: {\n      code: code,\n      message: message,\n    },\n    ok: RESPONSE_STATUS.failure,\n  };\n};\n","import {\n  defaultParser,\n  type Fetcher,\n  generateRequestFailure,\n  RESPONSE_STATUS,\n  type RequestParser,\n  type RequestResult,\n  type RequestSuccess,\n} from \".\";\n\nexport type GetRequestOptions<T> = {\n  fetch?: Fetcher;\n  init?: Omit<RequestInit, \"method\">;\n  parser?: RequestParser<T>;\n};\n\n/**\n * `fetch` を用いた GET リクエストを発行し、JSON などのレスポンスを取得する。\n * fetch 実装やパーサーを注入できるため、ブラウザ／Node 双方で柔軟に扱える。\n *\n * @param url - 送信先の URL\n * @param options - fetch 実装・リクエストオプション・レスポンスパーサーの指定\n * @returns 成功時は `ok: true` とデータ、失敗時は `ok: false` と `Error`\n */\nexport async function getRequest<T = unknown>(\n  url: string,\n  options: GetRequestOptions<T> = {},\n): Promise<RequestResult<T>> {\n  const { fetch: customFetch, init, parser = defaultParser<T> } = options;\n  const fetcher: Fetcher | undefined = customFetch ?? globalThis.fetch;\n\n  if (typeof fetcher !== \"function\") {\n    return generateRequestFailure(\n      \"FETCH_API_ERROR\",\n      \"Fetch API is not available in the current environment.\",\n    );\n  }\n\n  try {\n    const response = await fetcher(url, {\n      ...init,\n      method: \"GET\",\n    });\n\n    if (!response.ok) {\n      return generateRequestFailure(\n        response.status.toString(),\n        response.statusText,\n      );\n    }\n\n    return {\n      data: await parser(response),\n      ok: RESPONSE_STATUS.success,\n    } satisfies RequestSuccess<T>;\n  } catch (error) {\n    if (error instanceof Error) {\n      return generateRequestFailure(\"UNKNOWN_ERROR\", error.message);\n    }\n\n    return generateRequestFailure(\"UNKNOWN_ERROR\", \"Unknown error.\");\n  }\n}\n","import {\n  defaultParser,\n  type Fetcher,\n  generateRequestFailure,\n  RESPONSE_STATUS,\n  type RequestParser,\n  type RequestResult,\n  type RequestSuccess,\n} from \".\";\n\nexport type PostRequestOptions<T, B> = {\n  fetch?: Fetcher;\n  init?: Omit<RequestInit, \"method\" | \"body\" | \"headers\">;\n  body?: B;\n  headers?: HeadersInit;\n  parser?: RequestParser<T>;\n  serialize?: (body: B) => BodyInit | null | undefined;\n};\n\nconst isBodyInit = (body: unknown): body is BodyInit => {\n  return (\n    body instanceof Blob ||\n    body instanceof FormData ||\n    body instanceof URLSearchParams ||\n    body instanceof ReadableStream ||\n    body instanceof ArrayBuffer ||\n    ArrayBuffer.isView(body)\n  );\n};\n\n/**\n * `fetch` を用いた POST リクエストを発行し、レスポンスを取得する。\n * fetch 実装やパーサーを注入できるため、ブラウザ／Node 双方で柔軟に扱える。\n *\n * @param url - 送信先の URL\n * @param options - fetch 実装・リクエストオプション・レスポンスパーサーの指定\n * @returns 成功時は `ok: true` とデータ、失敗時は `ok: false` と `Error`\n */\nexport async function postRequest<T = unknown, B = unknown>(\n  url: string,\n  options: PostRequestOptions<T, B> = {},\n): Promise<RequestResult<T>> {\n  const {\n    fetch: customFetch,\n    init,\n    body,\n    headers,\n    parser = defaultParser<T>,\n    serialize,\n  } = options;\n  const fetcher: Fetcher | undefined = customFetch ?? globalThis.fetch;\n\n  if (typeof fetcher !== \"function\") {\n    return generateRequestFailure(\n      \"FETCH_API_ERROR\",\n      \"Fetch API is not available in the current environment.\",\n    );\n  }\n\n  try {\n    let payload: BodyInit | null | undefined;\n    if (serialize) {\n      if (body) {\n        payload = serialize(body);\n      }\n    } else if (isBodyInit(body)) {\n      payload = body;\n    } else if (typeof body === \"string\") {\n      payload = JSON.stringify(body);\n    }\n\n    const baseHeaders = new Headers(headers);\n    if (typeof body === \"string\" && !baseHeaders.has(\"Content-type\")) {\n      baseHeaders.set(\"Content-type\", \"application/json\");\n    }\n\n    const response = await fetcher(url, {\n      ...init,\n      body: payload ?? null,\n      headers: baseHeaders,\n      method: \"POST\",\n    });\n\n    if (!response.ok) {\n      return generateRequestFailure(\n        response.status.toString(),\n        response.statusText,\n      );\n    }\n\n    return {\n      data: await parser(response),\n      ok: RESPONSE_STATUS.success,\n    } satisfies RequestSuccess<T>;\n  } catch (error) {\n    if (error instanceof Error) {\n      return generateRequestFailure(\"UNKNOWN_ERROR\", error.message);\n    }\n\n    return generateRequestFailure(\"UNKNOWN_ERROR\", \"Unknown error.\");\n  }\n}\n","/**\n * HTML タグと代表的な実体参照を除去し、生テキストのみを取り出す。\n *\n * @param text - HTML を含む文字列\n * @returns タグと代表的なエンティティを取り除いた文字列\n */\nexport function stripHtml(text: string): string {\n  return text.replace(/(<([^>]+)>)/gi, \"\").replace(/&[a-z]+;/gi, \"\");\n}\n","/**\n * データが`undefined`型かチェックする。主に`number`型の`0`などの`falsy`なデータの未定義チェックを行いたい場合に使用する\n *\n * @param {unknown} data 渡されるデータ\n *\n * @return {boolean}\n */\nexport function isUndefined(data: unknown): data is undefined {\n  return typeof data === \"undefined\";\n}\n"],"mappings":"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","names":[]}